---
title: pytest-mark
slug: pytest-mark
tags: [python, pytest]
---

pytest.mark ã®ä¸€èˆ¬çš„ãªä½¿ã„æ–¹

:::warning
ã¾ã æ›¸ãã‹ã‘ã§ã™ã€‚
:::


{/* truncate */}


```
ãƒãƒ¼ã‚¯	èª¬æ˜
@pytest.mark.asyncio	éåŒæœŸé–¢æ•°ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹ãŸã‚ã®ãƒãƒ¼ã‚¯
@pytest.mark.parametrize	ãƒ†ã‚¹ãƒˆã‚’ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åŒ–ï¼ˆè¤‡æ•°ã®å…¥åŠ›å€¤ã§å®Ÿè¡Œï¼‰
@pytest.mark.slow	pytest -m "slow" ã§ç‰¹å®šã®ã‚°ãƒ«ãƒ¼ãƒ—ã‚’å®Ÿè¡Œå¯èƒ½
@pytest.mark.skip	ã“ã®ãƒ†ã‚¹ãƒˆã‚’ã‚¹ã‚­ãƒƒãƒ—
@pytest.mark.xfail	å¤±æ•—ã™ã‚‹ã“ã¨ã‚’æœŸå¾…ã™ã‚‹ãƒ†ã‚¹ãƒˆ
âœ… ã¾ã¨ã‚
pytest.mark ã¯ ãƒ†ã‚¹ãƒˆã«ãƒ¡ã‚¿æƒ…å ±ã‚’ä»˜ä¸ã™ã‚‹ãŸã‚ã®æ©Ÿèƒ½ã€‚
@pytest.mark.asyncio â†’ éåŒæœŸãƒ†ã‚¹ãƒˆç”¨ã€‚
@pytest.mark.parametrize â†’ ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åŒ–ã—ã¦è¤‡æ•°ã®ãƒ†ã‚¹ãƒˆã‚’ä¸€åº¦ã«å®Ÿè¡Œã€‚
@pytest.mark.skip / @pytest.mark.xfail â†’ ã‚¹ã‚­ãƒƒãƒ—ã‚„å¤±æ•—è¨±å®¹ã€‚
ãƒ†ã‚¹ãƒˆã®ç®¡ç†ã‚„åˆ†é¡ã€éåŒæœŸå‡¦ç†ã®ã‚µãƒãƒ¼ãƒˆã«ä¾¿åˆ©ãªæ©Ÿèƒ½ã§ã™ï¼




poetry ã‚’ä½¿ã£ã¦ã€ç¾åœ¨ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’å–å¾—ã—ã€ç‰¹å®šã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ä»¥ä¸‹ï¼ˆã¾ãŸã¯ä»¥ä¸Šï¼‰ã§ãƒ†ã‚¹ãƒˆã‚’ã‚¹ã‚­ãƒƒãƒ—ã™ã‚‹æ–¹æ³•ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

æ–¹æ³•1: importlib.metadata ã‚’ä½¿ã†
Python 3.8 ä»¥ä¸Šãªã‚‰ importlib.metadataï¼ˆã¾ãŸã¯ importlib_metadataï¼‰ã‚’ä½¿ã£ã¦ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’å–å¾—ã§ãã¾ã™ã€‚

ä¾‹: package_name ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒ 1.2.0 æœªæº€ãªã‚‰ã‚¹ã‚­ãƒƒãƒ—
python
ã‚³ãƒ”ãƒ¼ã™ã‚‹
ç·¨é›†ã™ã‚‹
import pytest
from importlib.metadata import version, PackageNotFoundError

PACKAGE_NAME = "your_package"  # å®Ÿéš›ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åã«ç½®ãæ›ãˆã¦ãã ã•ã„

try:
    package_version = version(PACKAGE_NAME)
except PackageNotFoundError:
    package_version = "0.0.0"  # ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤

@pytest.mark.skipif(package_version < "1.2.0", reason="ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒ1.2.0æœªæº€ã®ãŸã‚ã‚¹ã‚­ãƒƒãƒ—")
def test_feature():
    assert some_function() == "expected"
è§£èª¬
importlib.metadata.version(PACKAGE_NAME) ã§ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’å–å¾—ã€‚
version < "1.2.0" ã®å ´åˆã«ãƒ†ã‚¹ãƒˆã‚’ã‚¹ã‚­ãƒƒãƒ—ã€‚
æ–¹æ³•2: packaging.version ã‚’ä½¿ã£ã¦ãƒãƒ¼ã‚¸ãƒ§ãƒ³æ¯”è¼ƒã‚’å³å¯†ã«
æ–‡å­—åˆ—æ¯”è¼ƒã§ã¯ãªãã€ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®æ­£ç¢ºãªæ¯”è¼ƒã‚’è¡Œã„ãŸã„å ´åˆã¯ packaging.version ã‚’ä½¿ã†ã¨ã‚ˆã„ã§ã™ã€‚

python
ã‚³ãƒ”ãƒ¼ã™ã‚‹
ç·¨é›†ã™ã‚‹
import pytest
from importlib.metadata import version, PackageNotFoundError
from packaging.version import Version

PACKAGE_NAME = "your_package"

try:
    package_version = Version(version(PACKAGE_NAME))
except PackageNotFoundError:
    package_version = Version("0.0.0")

@pytest.mark.skipif(package_version < Version("1.2.0"), reason="ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒ1.2.0æœªæº€ã®ãŸã‚ã‚¹ã‚­ãƒƒãƒ—")
def test_feature():
    assert some_function() == "expected"
packaging.version.Version ã‚’ä½¿ã†ãƒ¡ãƒªãƒƒãƒˆ
"1.10.0" > "1.2.0" ã®ã‚ˆã†ãªèª¤ã£ãŸæ¯”è¼ƒã‚’é˜²ãã€‚
1.2.0-alpha ã®ã‚ˆã†ãªãƒ—ãƒ¬ãƒªãƒªãƒ¼ã‚¹ç‰ˆã‚‚æ­£ã—ãæ¯”è¼ƒã§ãã‚‹ã€‚
æ–¹æ³•3: pytest_addoption ã‚’ä½¿ã£ã¦ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§åˆ¶å¾¡
ç‰¹å®šã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã§æŒ‡å®šã—ã€ã‚¹ã‚­ãƒƒãƒ—ã‚’åˆ¶å¾¡ã™ã‚‹æ–¹æ³•ã‚‚ã‚ã‚Šã¾ã™ã€‚

conftest.py
python
ã‚³ãƒ”ãƒ¼ã™ã‚‹
ç·¨é›†ã™ã‚‹
import pytest
from importlib.metadata import version
from packaging.version import Version

PACKAGE_NAME = "your_package"

@pytest.fixture(scope="session")
def package_version():
    return Version(version(PACKAGE_NAME))

def pytest_addoption(parser):
    parser.addoption("--min-version", action="store", default="0.0.0", help="Minimum required package version")

def pytest_runtest_setup(item):
    min_version = Version(item.config.getoption("--min-version"))
    current_version = Version(version(PACKAGE_NAME))
    if current_version < min_version:
        pytest.skip(f"ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ {current_version} ãŒ {min_version} æœªæº€ã®ãŸã‚ã‚¹ã‚­ãƒƒãƒ—")
ä½¿ã„æ–¹
sh
ã‚³ãƒ”ãƒ¼ã™ã‚‹
ç·¨é›†ã™ã‚‹
pytest --min-version=1.2.0
ğŸ‘‰ ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®é–¾å€¤ã‚’ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã§å¤‰æ›´ã§ãã‚‹ã®ã§ã€æŸ”è»Ÿãªãƒ†ã‚¹ãƒˆãŒå¯èƒ½ï¼

ã¾ã¨ã‚
æ–¹æ³•	ãƒ¡ãƒªãƒƒãƒˆ	ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ
importlib.metadata.version() ã‚’ä½¿ã†	ã‚·ãƒ³ãƒ—ãƒ«ã«ãƒãƒ¼ã‚¸ãƒ§ãƒ³å–å¾—	æ–‡å­—åˆ—æ¯”è¼ƒã ã¨ 1.10.0 < 1.2.0 ã®å•é¡ŒãŒã‚ã‚‹
packaging.version.Version() ã‚’ä½¿ã†	å³å¯†ãªãƒãƒ¼ã‚¸ãƒ§ãƒ³æ¯”è¼ƒãŒå¯èƒ½	packaging ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒå¿…è¦
pytest_addoption ã§åˆ¶å¾¡	CLI ã§æŸ”è»Ÿã«ãƒãƒ¼ã‚¸ãƒ§ãƒ³åˆ¶å¾¡	conftest.py ãŒå¿…è¦
ğŸ‘‰ ã‚·ãƒ³ãƒ—ãƒ«ãªã‚‰ importlib.metadata ã‚’ä½¿ã†ã€‚å³å¯†ã«æ¯”è¼ƒã™ã‚‹ãªã‚‰ packaging.version ã‚’ä½¿ã†ã®ãŒã‚ªã‚¹ã‚¹ãƒ¡ï¼


```